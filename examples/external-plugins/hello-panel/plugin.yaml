# Hello Panel - æ··åˆæ ¼å¼æ’ä»¶ç¤ºä¾‹
# å±•ç¤ºå¦‚ä½•ä½¿ç”¨å£°æ˜å¼ UI + JS è„šæœ¬ + è‡ªå®šä¹‰æ ·å¼

id: external-hello-panel
version: 2.1.0
name: Hello Panel
description: å±•ç¤ºå¦‚ä½•åœ¨ IdoFront ä¸­æ³¨å†Œè‡ªå®šä¹‰ UI æŒ‰é’®ï¼Œä½¿ç”¨ Store å’Œ Storage APIï¼Œä»¥åŠè‡ªå®šä¹‰ CSS æ ·å¼
author: IdoFront Team
icon: waving_hand

# ============================================================
# è‡ªå®šä¹‰æ ·å¼ - ä¸»çº¿ç¨‹ç›´æ¥æ³¨å…¥ï¼Œé›¶å»¶è¿Ÿ
# ============================================================
styles: |
  /* Hello Panel è‡ªå®šä¹‰æ ·å¼ */
  .hello-panel-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
    border-radius: 12px !important;
    transition: all 0.3s ease !important;
  }
  
  .hello-panel-btn:hover {
    transform: scale(1.1) !important;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4) !important;
  }
  
  .hello-panel-btn .material-symbols-rounded {
    color: white !important;
  }
  
  /* åŠ¨ç”»æ•ˆæœ */
  @keyframes hello-wave {
    0%, 100% { transform: rotate(0deg); }
    25% { transform: rotate(20deg); }
    75% { transform: rotate(-15deg); }
  }
  
  .hello-panel-btn:active .material-symbols-rounded {
    animation: hello-wave 0.5s ease-in-out;
  }

# ============================================================
# å£°æ˜å¼ UI éƒ¨åˆ† - ä¸»çº¿ç¨‹ç›´æ¥æ¸²æŸ“ï¼Œé›¶å»¶è¿Ÿ
# ============================================================
ui:
  HEADER_ACTIONS:
    - id: hello-button
      component: md-icon-button
      props:
        icon: waving_hand
        label: Hello
        title: ç‚¹å‡»æ’å…¥é—®å€™è¯­
        class: hello-panel-btn
      onClick:
        action: emit
        event: plugin:hello-button:click

# ============================================================
# è®¾ç½®å£°æ˜ - è‡ªåŠ¨ç”Ÿæˆè®¾ç½®è¡¨å•
# ============================================================
settings:
  section:
    title: Hello Panel è®¾ç½®
    icon: waving_hand
  fields:
    greeting:
      type: text
      label: é—®å€™è¯­å‰ç¼€
      hint: ç‚¹å‡»æŒ‰é’®æ—¶æ˜¾ç¤ºçš„é—®å€™è¯­
      default: æ¥è‡ªå¤–éƒ¨æ’ä»¶çš„é—®å€™ ğŸ‘‹

# ============================================================
# JS è„šæœ¬éƒ¨åˆ† - ä»…å¤„ç†ç‚¹å‡»é€»è¾‘ï¼Œåœ¨æ²™ç®±æ‰§è¡Œ
# ============================================================
script: |
  (function() {
      'use strict';
      
      const CONFIG_KEY = 'hello-panel:config';
      let clickCount = 0;
      
      // åŠ è½½ä¿å­˜çš„é…ç½®
      async function loadConfig() {
          try {
              const config = await IdoFront.storage.getItem(CONFIG_KEY);
              if (config && typeof config.clickCount === 'number') {
                  clickCount = config.clickCount;
                  console.log('[HelloPanel] å·²æ¢å¤ç‚¹å‡»è®¡æ•°:', clickCount);
              }
          } catch (error) {
              console.warn('[HelloPanel] åŠ è½½é…ç½®å¤±è´¥:', error);
          }
      }
      
      // ä¿å­˜é…ç½®
      async function saveConfig() {
          try {
              await IdoFront.storage.setItem(CONFIG_KEY, {
                  clickCount,
                  lastUpdated: Date.now()
              });
          } catch (error) {
              console.warn('[HelloPanel] ä¿å­˜é…ç½®å¤±è´¥:', error);
          }
      }
      
      // å¤„ç†æŒ‰é’®ç‚¹å‡»
      async function handleClick() {
          clickCount++;
          await saveConfig();
          
          // è·å–è®¾ç½®
          const settings = await Plugin.getSettings();
          const greeting = settings.greeting || 'æ¥è‡ªå¤–éƒ¨æ’ä»¶çš„é—®å€™ ğŸ‘‹';
          
          // è·å–å½“å‰ä¼šè¯ä¿¡æ¯
          let conversationInfo = '';
          try {
              const conv = await IdoFront.store.getActiveConversation();
              if (conv) {
                  conversationInfo = `\nå½“å‰ä¼šè¯ï¼šã€Œ${conv.title || 'æœªå‘½å'}ã€ï¼Œå…± ${conv.messages?.length || 0} æ¡æ¶ˆæ¯`;
              }
          } catch (error) {
              console.warn('[HelloPanel] è·å–ä¼šè¯ä¿¡æ¯å¤±è´¥:', error);
          }
          
          // å‘é€æ¶ˆæ¯
          Framework.addMessage('assistant', {
              content: `${greeting} (ç¬¬ ${clickCount} æ¬¡ç‚¹å‡»)${conversationInfo}`,
              reasoning: 'è¿™æ˜¯ä¸€ä¸ªæ··åˆæ ¼å¼æ’ä»¶ç¤ºä¾‹'
          });
      }
      
      // åˆå§‹åŒ–
      loadConfig().then(() => {
          console.log('[HelloPanel] æ’ä»¶å·²åˆå§‹åŒ–');
      });
      
      // ç›‘å¬æ¥è‡ªä¸»çº¿ç¨‹çš„ç‚¹å‡»äº‹ä»¶
      IdoFront.store.events.on('plugin:hello-button:click', handleClick);
      
      console.log('[HelloPanel] æ··åˆæ ¼å¼æ’ä»¶åŠ è½½å®Œæˆ');
  })();