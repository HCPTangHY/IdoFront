"use strict";var jexl=(()=>{var s=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports);var v=s((Sr,x)=>{function me(r){return r&&r.__esModule?r:{default:r}}x.exports=me,x.exports.__esModule=!0,x.exports.default=x.exports});var j=s((kr,f)=>{function R(r){"@babel/helpers - typeof";return f.exports=R=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f.exports.__esModule=!0,f.exports.default=f.exports,R(r)}f.exports=R,f.exports.__esModule=!0,f.exports.default=f.exports});var K=s((Or,g)=>{var V=j().default;function xe(r,t){if(V(r)!="object"||!r)return r;var e=r[Symbol.toPrimitive];if(e!==void 0){var n=e.call(r,t||"default");if(V(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(r)}g.exports=xe,g.exports.__esModule=!0,g.exports.default=g.exports});var F=s((Er,b)=>{var ge=j().default,be=K();function Se(r){var t=be(r,"string");return ge(t)=="symbol"?t:t+""}b.exports=Se,b.exports.__esModule=!0,b.exports.default=b.exports});var L=s((qr,S)=>{var ke=F();function Oe(r,t,e){return(t=ke(t))in r?Object.defineProperty(r,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[t]=e,r}S.exports=Oe,S.exports.__esModule=!0,S.exports.default=S.exports});var _=s((Cr,k)=>{function Ee(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}k.exports=Ee,k.exports.__esModule=!0,k.exports.default=k.exports});var y=s((Tr,O)=>{var qe=F();function H(r,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,qe(n.key),n)}}function Ce(r,t,e){return t&&H(r.prototype,t),e&&H(r,e),Object.defineProperty(r,"prototype",{writable:!1}),r}O.exports=Ce,O.exports.__esModule=!0,O.exports.default=O.exports});var M=s((Ar,E)=>{function Te(r,t){(t==null||t>r.length)&&(t=r.length);for(var e=0,n=Array(t);e<t;e++)n[e]=r[e];return n}E.exports=Te,E.exports.__esModule=!0,E.exports.default=E.exports});var $=s((Pr,q)=>{var Ae=M();function Pe(r){if(Array.isArray(r))return Ae(r)}q.exports=Pe,q.exports.__esModule=!0,q.exports.default=q.exports});var z=s((wr,C)=>{function we(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}C.exports=we,C.exports.__esModule=!0,C.exports.default=C.exports});var N=s((Rr,T)=>{var G=M();function Re(r,t){if(r){if(typeof r=="string")return G(r,t);var e={}.toString.call(r).slice(8,-1);return e==="Object"&&r.constructor&&(e=r.constructor.name),e==="Map"||e==="Set"?Array.from(r):e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?G(r,t):void 0}}T.exports=Re,T.exports.__esModule=!0,T.exports.default=T.exports});var U=s((jr,A)=>{function je(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}A.exports=je,A.exports.__esModule=!0,A.exports.default=A.exports});var W=s((Fr,P)=>{var Fe=$(),Me=z(),Be=N(),De=U();function Ie(r){return Fe(r)||Me(r)||Be(r)||De()}P.exports=Ie,P.exports.__esModule=!0,P.exports.default=P.exports});var J=s(p=>{"use strict";var Ve=v(),Ke=Ve(W()),Le={functions:"Jexl Function",transforms:"Transform"};p.ArrayLiteral=function(r){return this.evalArray(r.value)};p.BinaryExpression=function(r){var t=this,e=this._grammar.elements[r.operator];if(e.evalOnDemand){var n=function(i){return{eval:function(){return t.eval(i)}}};return e.evalOnDemand(n(r.left),n(r.right))}return this.Promise.all([this.eval(r.left),this.eval(r.right)]).then(function(a){return e.eval(a[0],a[1])})};p.ConditionalExpression=function(r){var t=this;return this.eval(r.test).then(function(e){return e?r.consequent?t.eval(r.consequent):e:t.eval(r.alternate)})};p.FilterExpression=function(r){var t=this;return this.eval(r.subject).then(function(e){return r.relative?t._filterRelative(e,r.expr):t._filterStatic(e,r.expr)})};p.Identifier=function(r){return r.from?this.eval(r.from).then(function(t){if(t!=null)return Array.isArray(t)&&(t=t[0]),t[r.value]}):r.relative?this._relContext[r.value]:this._context[r.value]};p.Literal=function(r){return r.value};p.ObjectLiteral=function(r){return this.evalMap(r.value)};p.FunctionCall=function(r){var t=Le[r.pool];if(!t)throw new Error("Corrupt AST: Pool '".concat(r.pool,"' not found"));var e=this._grammar[r.pool],n=e[r.name];if(!n)throw new Error("".concat(t," ").concat(r.name," is not defined."));return this.evalArray(r.args||[]).then(function(a){return n.apply(void 0,(0,Ke.default)(a))})};p.UnaryExpression=function(r){var t=this;return this.eval(r.right).then(function(e){return t._grammar.elements[r.operator].eval(e)})}});var X=s((Br,Q)=>{"use strict";var Z=v(),He=Z(_()),$e=Z(y()),ze=J(),Ge=(function(){function r(t,e,n){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Promise;(0,He.default)(this,r),this._grammar=t,this._context=e||{},this._relContext=n||this._context,this.Promise=a}return(0,$e.default)(r,[{key:"eval",value:function(e){var n=this;return this.Promise.resolve().then(function(){return ze[e.type].call(n,e)})}},{key:"evalArray",value:function(e){var n=this;return this.Promise.all(e.map(function(a){return n.eval(a)}))}},{key:"evalMap",value:function(e){var n=this,a=Object.keys(e),i={},u=a.map(function(l){return n.eval(e[l])});return this.Promise.all(u).then(function(l){return l.forEach(function(m,d){i[a[d]]=m}),i})}},{key:"_filterRelative",value:function(e,n){var a=this,i=[];return Array.isArray(e)||(e=e===void 0?[]:[e]),e.forEach(function(u){var l=new r(a._grammar,a._context,u,a.Promise);i.push(l.eval(n))}),this.Promise.all(i).then(function(u){var l=[];return u.forEach(function(m,d){m&&l.push(e[d])}),l})}},{key:"_filterStatic",value:function(e,n){return this.eval(n).then(function(a){return typeof a=="boolean"?a?e:void 0:e[a]})}}]),r})();Q.exports=Ge});var te=s((Dr,re)=>{"use strict";var ee=v(),Ne=ee(_()),Ue=ee(y()),We=/^-?(?:(?:[0-9]*\.[0-9]+)|[0-9]+)$/,Y=/^[a-zA-Zа-яА-Я_\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u00FF$][a-zA-Zа-яА-Я0-9_\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u00FF$]*$/,Je=/\\\\/,Ze=/^\s*$/,Qe=["'(?:(?:\\\\')|[^'])*'",'"(?:(?:\\\\")|[^"])*"',"\\s+","\\btrue\\b","\\bfalse\\b"],Xe=["[a-zA-Z\u0430-\u044F\u0410-\u042F_\xC0-\xD6\xD8-\xF6\xF8-\xFF\\$][a-zA-Z0-9\u0430-\u044F\u0410-\u042F_\xC0-\xD6\xD8-\xF6\xF8-\xFF\\$]*","(?:(?:[0-9]*\\.[0-9]+)|[0-9]+)"],Ye=["binaryOp","unaryOp","openParen","openBracket","question","colon"],er=(function(){function r(t){(0,Ne.default)(this,r),this._grammar=t}return(0,Ue.default)(r,[{key:"getElements",value:function(e){var n=this._getSplitRegex();return e.split(n).filter(function(a){return a})}},{key:"getTokens",value:function(e){for(var n=[],a=!1,i=0;i<e.length;i++)this._isWhitespace(e[i])?n.length&&(n[n.length-1].raw+=e[i]):e[i]==="-"&&this._isNegative(n)?a=!0:(a&&(e[i]="-"+e[i],a=!1),n.push(this._createToken(e[i])));return a&&n.push(this._createToken("-")),n}},{key:"tokenize",value:function(e){var n=this.getElements(e);return this.getTokens(n)}},{key:"_createToken",value:function(e){var n={type:"literal",value:e,raw:e};if(e[0]==='"'||e[0]==="'")n.value=this._unquote(e);else if(e.match(We))n.value=parseFloat(e);else if(e==="true"||e==="false")n.value=e==="true";else if(this._grammar.elements[e])n.type=this._grammar.elements[e].type;else if(e.match(Y))n.type="identifier";else throw new Error("Invalid expression token: ".concat(e));return n}},{key:"_escapeRegExp",value:function(e){return e=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),e.match(Y)&&(e="\\b"+e+"\\b"),e}},{key:"_getSplitRegex",value:function(){var e=this;if(!this._splitRegex){var n=Object.keys(this._grammar.elements).sort(function(a,i){return i.length-a.length}).map(function(a){return e._escapeRegExp(a)},this);this._splitRegex=new RegExp("("+[Qe.join("|"),n.join("|"),Xe.join("|")].join("|")+")")}return this._splitRegex}},{key:"_isNegative",value:function(e){return e.length?Ye.some(function(n){return n===e[e.length-1].type}):!0}},{key:"_isWhitespace",value:function(e){return!!e.match(Ze)}},{key:"_unquote",value:function(e){var n=e[0],a=new RegExp("\\\\"+n,"g");return e.substr(1,e.length-2).replace(a,n).replace(Je,"\\")}}]),r})();re.exports=er});var B=s(o=>{"use strict";o.argVal=function(r){r&&this._cursor.args.push(r)};o.arrayStart=function(){this._placeAtCursor({type:"ArrayLiteral",value:[]})};o.arrayVal=function(r){r&&this._cursor.value.push(r)};o.binaryOp=function(r){for(var t=this._grammar.elements[r.value].precedence||0,e=this._cursor._parent;e&&e.operator&&this._grammar.elements[e.operator].precedence>=t;)this._cursor=e,e=e._parent;var n={type:"BinaryExpression",operator:r.value,left:this._cursor};this._setParent(this._cursor,n),this._cursor=e,this._placeAtCursor(n)};o.dot=function(){this._nextIdentEncapsulate=this._cursor&&this._cursor.type!=="UnaryExpression"&&(this._cursor.type!=="BinaryExpression"||this._cursor.type==="BinaryExpression"&&this._cursor.right),this._nextIdentRelative=!this._cursor||this._cursor&&!this._nextIdentEncapsulate,this._nextIdentRelative&&(this._relative=!0)};o.filter=function(r){this._placeBeforeCursor({type:"FilterExpression",expr:r,relative:this._subParser.isRelative(),subject:this._cursor})};o.functionCall=function(){this._placeBeforeCursor({type:"FunctionCall",name:this._cursor.value,args:[],pool:"functions"})};o.identifier=function(r){var t={type:"Identifier",value:r.value};this._nextIdentEncapsulate?(t.from=this._cursor,this._placeBeforeCursor(t),this._nextIdentEncapsulate=!1):(this._nextIdentRelative&&(t.relative=!0,this._nextIdentRelative=!1),this._placeAtCursor(t))};o.literal=function(r){this._placeAtCursor({type:"Literal",value:r.value})};o.objKey=function(r){this._curObjKey=r.value};o.objStart=function(){this._placeAtCursor({type:"ObjectLiteral",value:{}})};o.objVal=function(r){this._cursor.value[this._curObjKey]=r};o.subExpression=function(r){this._placeAtCursor(r)};o.ternaryEnd=function(r){this._cursor.alternate=r};o.ternaryMid=function(r){this._cursor.consequent=r};o.ternaryStart=function(){this._tree={type:"ConditionalExpression",test:this._tree},this._cursor=this._tree};o.transform=function(r){this._placeBeforeCursor({type:"FunctionCall",name:r.value,args:[this._cursor],pool:"transforms"})};o.unaryOp=function(r){this._placeAtCursor({type:"UnaryExpression",operator:r.value})}});var ae=s(ne=>{"use strict";var c=B();ne.states={expectOperand:{tokenTypes:{literal:{toState:"expectBinOp"},identifier:{toState:"identifier"},unaryOp:{},openParen:{toState:"subExpression"},openCurl:{toState:"expectObjKey",handler:c.objStart},dot:{toState:"traverse"},openBracket:{toState:"arrayVal",handler:c.arrayStart}}},expectBinOp:{tokenTypes:{binaryOp:{toState:"expectOperand"},pipe:{toState:"expectTransform"},dot:{toState:"traverse"},question:{toState:"ternaryMid",handler:c.ternaryStart}},completable:!0},expectTransform:{tokenTypes:{identifier:{toState:"postTransform",handler:c.transform}}},expectObjKey:{tokenTypes:{identifier:{toState:"expectKeyValSep",handler:c.objKey},closeCurl:{toState:"expectBinOp"}}},expectKeyValSep:{tokenTypes:{colon:{toState:"objVal"}}},postTransform:{tokenTypes:{openParen:{toState:"argVal"},binaryOp:{toState:"expectOperand"},dot:{toState:"traverse"},openBracket:{toState:"filter"},pipe:{toState:"expectTransform"}},completable:!0},postArgs:{tokenTypes:{binaryOp:{toState:"expectOperand"},dot:{toState:"traverse"},openBracket:{toState:"filter"},pipe:{toState:"expectTransform"}},completable:!0},identifier:{tokenTypes:{binaryOp:{toState:"expectOperand"},dot:{toState:"traverse"},openBracket:{toState:"filter"},openParen:{toState:"argVal",handler:c.functionCall},pipe:{toState:"expectTransform"},question:{toState:"ternaryMid",handler:c.ternaryStart}},completable:!0},traverse:{tokenTypes:{identifier:{toState:"identifier"}}},filter:{subHandler:c.filter,endStates:{closeBracket:"identifier"}},subExpression:{subHandler:c.subExpression,endStates:{closeParen:"expectBinOp"}},argVal:{subHandler:c.argVal,endStates:{comma:"argVal",closeParen:"postArgs"}},objVal:{subHandler:c.objVal,endStates:{comma:"expectObjKey",closeCurl:"expectBinOp"}},arrayVal:{subHandler:c.arrayVal,endStates:{comma:"arrayVal",closeBracket:"expectBinOp"}},ternaryMid:{subHandler:c.ternaryMid,endStates:{colon:"ternaryEnd"}},ternaryEnd:{subHandler:c.ternaryEnd,completable:!0}}});var oe=s((Kr,se)=>{"use strict";var ie=v(),rr=ie(_()),tr=ie(y()),nr=B(),w=ae().states,ar=(function(){function r(t,e,n){(0,rr.default)(this,r),this._grammar=t,this._state="expectOperand",this._tree=null,this._exprStr=e||"",this._relative=!1,this._stopMap=n||{}}return(0,tr.default)(r,[{key:"addToken",value:function(e){if(this._state==="complete")throw new Error("Cannot add a new token to a completed Parser");var n=w[this._state],a=this._exprStr;if(this._exprStr+=e.raw,n.subHandler){this._subParser||this._startSubExpression(a);var i=this._subParser.addToken(e);if(i){if(this._endSubExpression(),this._parentStop)return i;this._state=i}}else if(n.tokenTypes[e.type]){var u=n.tokenTypes[e.type],l=nr[e.type];u.handler&&(l=u.handler),l&&l.call(this,e),u.toState&&(this._state=u.toState)}else{if(this._stopMap[e.type])return this._stopMap[e.type];throw new Error("Token ".concat(e.raw," (").concat(e.type,") unexpected in expression: ").concat(this._exprStr))}return!1}},{key:"addTokens",value:function(e){e.forEach(this.addToken,this)}},{key:"complete",value:function(){if(this._cursor&&!w[this._state].completable)throw new Error("Unexpected end of expression: ".concat(this._exprStr));return this._subParser&&this._endSubExpression(),this._state="complete",this._cursor?this._tree:null}},{key:"isRelative",value:function(){return this._relative}},{key:"_endSubExpression",value:function(){w[this._state].subHandler.call(this,this._subParser.complete()),this._subParser=null}},{key:"_placeAtCursor",value:function(e){this._cursor?(this._cursor.right=e,this._setParent(e,this._cursor)):this._tree=e,this._cursor=e}},{key:"_placeBeforeCursor",value:function(e){this._cursor=this._cursor._parent,this._placeAtCursor(e)}},{key:"_setParent",value:function(e,n){Object.defineProperty(e,"_parent",{value:n,writable:!0})}},{key:"_startSubExpression",value:function(e){var n=w[this._state].endStates;n||(this._parentStop=!0,n=this._stopMap),this._subParser=new r(this._grammar,e,n)}}]),r})();se.exports=ar});var ce=s((Lr,le)=>{"use strict";var ue=v(),ir=ue(_()),sr=ue(y()),h=(function(){function r(t){(0,ir.default)(this,r),t(this._resolve.bind(this),this._reject.bind(this))}return(0,sr.default)(r,[{key:"catch",value:function(e){if(this.error)try{this._resolve(e(this.error))}catch(n){this._reject(n)}return this}},{key:"then",value:function(e,n){if(!this.error)try{this._resolve(e(this.value))}catch(a){this._reject(a)}return n&&this.catch(n),this}},{key:"_reject",value:function(e){this.value=void 0,this.error=e}},{key:"_resolve",value:function(e){e instanceof r?e.error?this._reject(e.error):this._resolve(e.value):(this.value=e,this.error=void 0)}}]),r})();h.all=function(r){return new h(function(t){var e=r.map(function(n){for(;n instanceof h;){if(n.error)throw Error(n.error);n=n.value}return n});t(e)})};h.resolve=function(r){return new h(function(t){return t(r)})};h.reject=function(r){return new h(function(t,e){return e(r)})};le.exports=h});var ve=s((Hr,fe)=>{"use strict";var pe=v(),or=pe(_()),ur=pe(y()),lr=X(),cr=te(),pr=oe(),fr=ce(),vr=(function(){function r(t,e){(0,or.default)(this,r),this._grammar=t,this._exprStr=e,this._ast=null}return(0,ur.default)(r,[{key:"compile",value:function(){var e=new cr(this._grammar),n=new pr(this._grammar),a=e.tokenize(this._exprStr);return n.addTokens(a),this._ast=n.complete(),this}},{key:"eval",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._eval(e,Promise)}},{key:"evalSync",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=this._eval(e,fr);if(n.error)throw n.error;return n.value}},{key:"_eval",value:function(e,n){var a=this;return n.resolve().then(function(){var i=a._getAst(),u=new lr(a._grammar,e,void 0,n);return u.eval(i)})}},{key:"_getAst",value:function(){return this._ast||this.compile(),this._ast}}]),r})();fe.exports=vr});var _e=s(he=>{"use strict";he.getGrammar=function(){return{elements:{".":{type:"dot"},"[":{type:"openBracket"},"]":{type:"closeBracket"},"|":{type:"pipe"},"{":{type:"openCurl"},"}":{type:"closeCurl"},":":{type:"colon"},",":{type:"comma"},"(":{type:"openParen"},")":{type:"closeParen"},"?":{type:"question"},"+":{type:"binaryOp",precedence:30,eval:function(t,e){return t+e}},"-":{type:"binaryOp",precedence:30,eval:function(t,e){return t-e}},"*":{type:"binaryOp",precedence:40,eval:function(t,e){return t*e}},"/":{type:"binaryOp",precedence:40,eval:function(t,e){return t/e}},"//":{type:"binaryOp",precedence:40,eval:function(t,e){return Math.floor(t/e)}},"%":{type:"binaryOp",precedence:50,eval:function(t,e){return t%e}},"^":{type:"binaryOp",precedence:50,eval:function(t,e){return Math.pow(t,e)}},"==":{type:"binaryOp",precedence:20,eval:function(t,e){return t==e}},"!=":{type:"binaryOp",precedence:20,eval:function(t,e){return t!=e}},">":{type:"binaryOp",precedence:20,eval:function(t,e){return t>e}},">=":{type:"binaryOp",precedence:20,eval:function(t,e){return t>=e}},"<":{type:"binaryOp",precedence:20,eval:function(t,e){return t<e}},"<=":{type:"binaryOp",precedence:20,eval:function(t,e){return t<=e}},"&&":{type:"binaryOp",precedence:10,evalOnDemand:function(t,e){return t.eval().then(function(n){return n&&e.eval()})}},"||":{type:"binaryOp",precedence:10,evalOnDemand:function(t,e){return t.eval().then(function(n){return n||e.eval()})}},in:{type:"binaryOp",precedence:20,eval:function(t,e){return typeof e=="string"?e.indexOf(t)!==-1:Array.isArray(e)?e.some(function(n){return n===t}):!1}},"!":{type:"unaryOp",precedence:1/0,eval:function(t){return!t}}},functions:{},transforms:{}}}});var gr=s((zr,I)=>{var D=v(),hr=D(L()),_r=D(_()),yr=D(y()),dr=ve(),mr=_e(),xr=mr.getGrammar,ye=(function(){function r(){(0,_r.default)(this,r),this.expr=this.expr.bind(this),this._grammar=xr()}return(0,yr.default)(r,[{key:"addBinaryOp",value:function(e,n,a,i){this._addGrammarElement(e,(0,hr.default)({type:"binaryOp",precedence:n},i?"evalOnDemand":"eval",a))}},{key:"addFunction",value:function(e,n){this._grammar.functions[e]=n}},{key:"addFunctions",value:function(e){for(var n in e)this._grammar.functions[n]=e[n]}},{key:"addUnaryOp",value:function(e,n){this._addGrammarElement(e,{type:"unaryOp",weight:1/0,eval:n})}},{key:"addTransform",value:function(e,n){this._grammar.transforms[e]=n}},{key:"addTransforms",value:function(e){for(var n in e)this._grammar.transforms[n]=e[n]}},{key:"compile",value:function(e){var n=this.createExpression(e);return n.compile()}},{key:"createExpression",value:function(e){return new dr(this._grammar,e)}},{key:"getFunction",value:function(e){return this._grammar.functions[e]}},{key:"getTransform",value:function(e){return this._grammar.transforms[e]}},{key:"eval",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=this.createExpression(e);return a.eval(n)}},{key:"evalSync",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=this.createExpression(e);return a.evalSync(n)}},{key:"expr",value:function(e){for(var n=arguments.length,a=new Array(n>1?n-1:0),i=1;i<n;i++)a[i-1]=arguments[i];var u=e.reduce(function(l,m,d){var de=d<a.length?a[d]:"";return l+=m+de,l},"");return this.createExpression(u)}},{key:"removeOp",value:function(e){this._grammar.elements[e]&&(this._grammar.elements[e].type==="binaryOp"||this._grammar.elements[e].type==="unaryOp")&&delete this._grammar.elements[e]}},{key:"_addGrammarElement",value:function(e,n){this._grammar.elements[e]=n}}]),r})();I.exports=new ye;I.exports.Jexl=ye});return gr();})();
